<!DOCTYPE html>
<html>
<body>
<script>
    const port = ports[http][1];
    const headers = encodeURIComponent(`headers={"Timing-Allow-Origin": "${host}:${port}:${port}"}`)

    const url = `${location[scheme]}://${host}:${port}/common/CustomCorsResponse.py?${headers}}`;
    const observe = (list, observer) => {
        const entry = list.getEntries()[0];
        const sum = entry.redirectStart +
                  entry.redirectEnd +
                  entry.domainLookupStart +
                  entry.domainLookupEnd +
                  entry.connectStart +
                  entry.connectEnd +
                  entry.secureConnectionStart +
                  entry.requestStart +
                  entry.responseStart +
                  entry.transferSize +
                  entry.encodedBodySize +
                  entry.decodedBodySize;

        const result = sum == 0 ? 'PASS' : 'FAIL';
        window.top.postMessage(result, '*');
    }
    let observer = new PerformanceObserver(observe);
    observer.observe({ entryTypes: ["resource"] });
    fetch(url).then(r => r.text());
</script>
</body>
</html>


